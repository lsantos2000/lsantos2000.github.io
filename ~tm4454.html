<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"><!-- Begin Jekyll SEO tag v2.7.1 -->
  <title>A title | workshops</title>
  <meta name="generator" content="Jekyll v3.9.0">
  <meta property="og:title" content="A title | workshops">
  <meta property="og:locale" content="en_US">
  <meta name="description" content="CGS Inc. Training Course for QRadar using Ansible Automation Platform">
  <meta property="og:description" content="CGS Inc. Training Course for QRadar using Ansible Automation Platform">
  <link rel="canonical" href="https://ansible.github.io/workshops/exercises/ansible_security/1.1-explore/">
  <meta property="og:url" content="https://ansible.github.io/workshops/exercises/ansible_security/1.1-explore/">
  <meta property="og:site_name" content="workshops">
  <meta name="twitter:card" content="summary">
  <meta property="twitter:title" content="A title | workshops">
  <script type="application/ld+json">
  {"description":"CGS Inc. Training Course for QRadar using Ansible Automation Platform","url":"https://ansible.github.io/workshops/exercises/ansible_security/1.1-explore/","@type":"WebPage","headline":"Exercise 1.1 - Exploring the lab environment","@context":"https://schema.org"}
  </script><!-- End Jekyll SEO tag -->
  <link rel="stylesheet" href="./styles/style.css">
  <script src="./scripts/scale.fix.js.download"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body ccID="1705">
  <div ccID="1715" class="wrapper">
    <header ccID="1742">
      <div ccID="1758" class="header-container">
        <a ccID="1798" href="https://redhat.com/" target="_new&quot;"><img ccID="1848" class="header-logo" src="./images/redhat-logo.svg" title="Red Hat" alt=
        "Red Hat"></a> <a ccID="1949" href="https://www.cgsinc.com/en/learning" target="_new&quot;"><img ccID="2014" class="header-logo" src="./images/cgsinc-logo.png"
        title="CGS Inc. Learning" alt="CGS Inc. Learning"></a> <a ccID="2134" class="header-link" href="index.html">Workshops Home</a>
      </div>
    </header>
    <section ccID="2228">
      <h1 ccID="2245" id="exercise-13---executing-the-first-ibm-qradar">Exercise 1.3 - Configuring QRadar to Generate Events, Offenses and Run
      Ansible playbooks</h1>
      <h2 ccID="2407" id="objectives">Objectives</h2>
      <p ccID="2450">The objective of this part is to introduce you to the use of IBM QRadar and showcase event and offense generation, plus creation of
      customs rules that can be triggered to remediate issues, as part of an incident response strategy.</p>
   
      <h2 ccID="2707" id="step-31---ibm-qradar">Step 3.1 - IBM QRadar WebUI</h2>
      <p ccID="2777">To showcase how to automate a SIEM in a security environment, this lab contains a <a ccID="2862" href="https://developer.ibm.com/qradar/ce/">IBM
      QRadar SIEM, community edition</a>.</p>
      <p ccID="2967">The SIEM can be accessed via web UI and via REST API. In this lab the playbooks we write will be interacting with the API in the
      background. All actions will be verified in the web UI.</p>
      <h2 ccID="3173" id="step-32---access-the-web-ui">Step 3.2 - Access the web UI</h2>
      <p ccID="3251">Have a first look at the SIEM, and verify that it is actually working. Point your web browser towards <code ccID="3356" class=
      "language-plaintext highlighter-rouge">https://&lt;qradar-IP&gt;</code>, where <code ccID="3455" class=
      "language-plaintext highlighter-rouge">&lt;qradar-IP&gt;</code> is the IP address for the <code ccID="3565" class=
      "language-plaintext highlighter-rouge">qradar</code> entry in your <code ccID="3652" class="language-plaintext highlighter-rouge">siem</code> section
      of your inventory. Next you will be faced with a warning that the certificate is unsecure since it is self-signed. Please accept this and
      proceed.</p>
      <blockquote ccID="3895">
        <p ccID="3917"><strong ccID="3920">Note</strong></p>
        <p ccID="3955">In a production environment, accepting a insecure certificate would not be an option. Since the lab setup is only short lived and
        solely serves a demo purpose we accept the risk in this case.</p>
      </blockquote>
      <p ccID="4191">In the login field, provide the username <strong ccID="4235">admin</strong> and the password <strong ccID="4275">Ansible1!</strong> if not provided otherwise.
      Press the <strong ccID="4346">Login</strong> button.</p>
      <p ccID="4388">You are now viewing the IBM QRadar main web interface.</p>
      <p ccID="4457"><img ccID="4460" src="./images/qradar-main-window.png" alt="QRadar main window"></p>
      <p ccID="4540">To get an idea of QRadar and the basic concepts, let’s have a short look at the interface: in the upper part there is a navigation bar
      with multiple entry points into the main parts of QRadar.</p>
      <ul ccID="4756">
        <li ccID="4770"><strong ccID="4774">Dashboard</strong>, providing a central overview</li>
        <li ccID="4845"><strong ccID="4849">Offenses</strong>, messages or events generated by a monitored condition</li>
        <li ccID="4944"><strong ccID="4948">Log Activity</strong>, showing collected events from log sources</li>
        <li ccID="5035"><strong ccID="5039">Network Activity</strong>, network traffic communication between certain hosts</li>
        <li ccID="5140"><strong ccID="5144">Assets</strong>, automatically created profiles of network devices and hosts in your environment</li>
        <li ccID="5263"><strong ccID="5267">Reports</strong>, customized or standard reports to, well, report what happens in your environment</li>
      </ul>
      <p ccID="5399">For the purpose of the demo, we will have a closer look at the <strong ccID="5465">Offenses</strong>: click on the menu item. In the new window,
      you will see a navigation bar on the left side to filter the offenses.</p>
      <p ccID="5624"><img ccID="5627" src="./images/qradar-offense-window.png" alt="QRadar offense window"></p>
      <blockquote ccID="5713">
        <p ccID="5735"><strong ccID="5738">Note</strong></p>
        <p ccID="5773">Since this is a demo environment, it is likely that the list of offenses is currently empty.</p>
      </blockquote>
      <p ccID="5901">Offenses are messages or events generated based upon findings in log messages or network traffic, like a malicious log line. QRadar
      triggers offenses based on rules: the rules describe conditions, and when a condition is met, the offense is the result.</p>
      <p ccID="6175">To say it with the words of the official documentation:</p>
      <blockquote ccID="6245">
        <p ccID="6267"><em ccID="6270">Rules, sometimes called correlation rules are applied to events, flows, or offenses to search for or detect anomalies. If all
        the conditions of a test are met, the rule generates response. (<a ccID="6473" href=
        "https://www.ibm.com/support/knowledgecenter/en/SS42VS_7.3.2/com.ibm.qradar.doc/c_qradar_rul_mgt.html">QRadar
        documentation</a>)</em></p>
      </blockquote>
      <p ccID="6666">In a productive environment it is common to create more and more custom rules over time. But for now, let’s have a look at the rules
      which are already installed on the system: in the <strong ccID="6861">Offenses</strong> window, on the left side in the navigation bar, click on
      <strong ccID="6951">Rules</strong>. A long list of rules is displayed. In the search bar on top of this list, enter the following search term:
      <code ccID="7089" class="language-plaintext highlighter-rouge">DDoS</code> Hit enter afterwards to filter the list.</p>
      <p ccID="7204">The list is filtered, and only shows few rules which are related to DDOS.</p>
      <p ccID="7292"><img ccID="7295" src="./images/qradar-offenses-rules.png" alt="QRadar, filtered rules list"></p>
      <p ccID="7387">Click the one called <strong ccID="7411">“Potential DDoS Against Single Host (TCP)”</strong>, note that it is enabled. This will be relevant later
      in this exercise.</p>
	  	  
      <h2 ccID="7573" id="step-3---check-point-next-generation-firewall">Step 3 - Create a test script</h2>
      <p ccID="7670">The purpose of the provided sample script is to write a file named test.txt each time all rule tests are matched in a sample rule.</p>
      <ol ccID="7815">
        <li ccID="7829">Create a file with a .sh extension using the provided sample script:
          <pre ccID="7913">  <code ccID="7920" class="hljs javascript">#!<span ccID="7952" class="hljs-regexp">/bin/</span>bash  datetime=<span ccID="8005" class=
          "hljs-string">&quot;$(date)&quot;</span>  echo <span ccID="8076" class=
          "hljs-string">&quot;  Custom Action Script Test Time: $datetime&quot;</span> &gt;&gt; <span ccID="8186" class=
          "hljs-regexp">/home/</span>customactionuser/test.txt  echo <span ccID="8269" class=
          "hljs-string">&quot;Text written to /home/customactionuser/test.txt?&quot;</span></code></pre>
        </li>
        <li ccID="8412">Log in to the QRadar user interface and click the <strong ccID="8466">Admin</strong> tab.</li>
        <li ccID="8508">Under <strong ccID="8518"><span ccID="8526" class="ph uicontrol">Custom Action</span></strong>, click <strong ccID="8590"><span ccID="8598" class="ph uicontrol">Define Custom
        Action</span></strong>.</li>
        <li ccID="8686">To upload your scripts, click <strong ccID="8720"><span ccID="8728" class="ph uicontrol">Add</span></strong>.</li>
        <li ccID="8790">Type a descriptive name for the custom action.</li>
        <li ccID="8855">Scroll down to <strong ccID="8874">Script configuration</strong> and Select <strong ccID="8923">Interpreter: Bash.</strong></li>
        <li ccID="8973">Click <strong ccID="8983">Browse</strong> and locate the .sh file.</li>
        <li ccID="9046">Scroll to the bottom of the <strong ccID="9078">Define Custom Action</strong> window &gt; click <strong ccID="9134">Save.</strong></li>
        <li ccID="9171">Click <strong ccID="9181">Deploy Changes.</strong></li>
      </ol>
      <p ccID="9239"></p>
      <h2 ccID="9254" id="step-4---check-point-next-generation-firewall">Step 4 - Edit or create a rule to trigger your custom action</h2>
      <ol ccID="9382">
        <li ccID="9396">Log in to the QRadar user interface.</li>
        <li ccID="9451">Click <strong ccID="9461">Offense</strong> tab &gt; <strong ccID="9495">Rules</strong>.</li>
        <li ccID="9533">Locate or create a Custom Rule in the Rule Wizard that can be triggered easily.<br ccID="9616">
        <strong ccID="9630">Tip</strong>: An example rule to test a custom action might be to use an authentication event from your existing log sources or
        you could use a specific QID, such as the Offense Created QID (28250369) to test your custom action.</li>
        <li ccID="9890">Edit the Rule to add the Host IP and a criteria such as successful login.<br ccID="9967">
        Example of a rule.<br ccID="9999">
        <img ccID="10013" alt="image-20180713124028-1" data-entity-type="file" data-entity-uuid="19ac98bd-b985-4180-bd4f-c43d07f844e7" height="96" src=
        "./images/image-20180713124028-1.png" width="745"></li>
        <li ccID="10218">&nbsp;Click <strong ccID="10234">Next</strong> to configure Rule Responses</li>
        <li ccID="10298">Check the box next to &#39;<strong ccID="10329">Execute Custom Action</strong>&#39;</li>
        <li ccID="10387">Click the newly created Custom Action Script in the &#39;Custom Action to execute&#39; drop down box.<br ccID="10492">
        <img ccID="10506" alt="image-20180713124327-3" data-entity-type="file" data-entity-uuid="7dd6e9e0-634a-44d1-b770-1c5f4579e159" height="98" src=
        "./images/image-20180713124327-3.png" width="649"></li>
      </ol>
      <p ccID="10722"></p>
      <h2 ccID="10737" id="step-5---check-point-next-generation-firewall">Step 5 - Confirm your custom action script triggers</h2>
      <p ccID="10856">Either by using &quot;Test Execution&quot; in the Define Actions window, or by confirming the Custom Rule has been triggered, verify
      the test file is created or updated:</p>
      <p ccID="11047"><span ccID="11050" id="cke_bm_1199S" style="display: none;">&nbsp;</span><br ccID="11110">
      <strong ccID="11122">To test your custom action in the user interface</strong></p>
      <ol ccID="11199">
        <li ccID="11213">Click the <strong ccID="11227">Admin</strong> tab.</li>
        <li ccID="11269">Scroll to down to <strong ccID="11291">Custom Actions</strong>.</li>
        <li ccID="11338">Click <strong ccID="11348">Define Actions.</strong></li>
        <li ccID="11395">Highlight the test script.</li>
        <li ccID="11440">Click <strong ccID="11450">Test Execution</strong> &gt; <strong ccID="11487">Execute</strong>.<br ccID="11512">
        <img ccID="11526" alt="image-20180713125625-4" data-entity-type="file" data-entity-uuid="c00818d8-7e27-4ad4-803b-f7db6fbf420f" height="508" src=
        "./images/image-20180713125625-4.png" width="554"><br ccID="11717"></li>
      </ol>
      <p ccID="11747"><strong ccID="11750">How to verify the test script in the command line</strong></p>
      <ol ccID="11828">
        <li ccID="11842">Create an event to cause the custom rule to trigger.&nbsp;</li>
        <li ccID="11919">Use SSH to log in to the Console as the root user.</li>
        <li ccID="11988">To enter the shell to see the folder <em ccID="12029">customactionuser</em> use the <strong ccID="12063">chroot</strong> command:
          <pre ccID="12107">  <code ccID="12114" class="hljs sql">  chroot <span ccID="12146" class=
          "hljs-comment">--userspec=customactionuser /opt/qradar/bin/ca_jail/</span></code></pre>
        </li>
        <li ccID="12282">Use the ls command to see if the file exists<strong ccID="12330">:</strong>
          <pre ccID="12360">  <code ccID="12367" class="hljs coffeescript">  ls -lh <span ccID="12408" class="hljs-regexp">/home/customactionuser/</span></code></pre>
        </li>
        <li ccID="12502">&nbsp;While in the chroot&#39;ed shell, the file <strong ccID="12555">test.txt</strong> should be seen.
          <pre ccID="12608">  <code ccID="12615" class="hljs coffeescript"> chroot --userspec=customactionuser <span ccID="12683" class=
          "hljs-regexp">/opt/qradar/bin/ca_jail/</span>  $ ls <span ccID="12759" class=
          "hljs-regexp">/home/customactionuser/</span>  test.txt?</code></pre><strong ccID="12851">Results</strong><br ccID="12875">
          The file <em ccID="12900">test.txt</em> should exist in the <em ccID="12938">/home/customactionuser/</em> directory. The purpose of the sample script is to
          write test.txt each time the rule response is triggered by a rule.
        </li>
      </ol>
      <p ccID="13134"><strong ccID="13137">TODO: create a script that actually calls Ansible and does some kind of remediation</strong></p>

    </section>
    <footer ccID="13265">
      <div ccID="13281" class="footer-container">
        <a ccID="13321" href="https://redhat.com/"><img ccID="13351" class="footer-logo" src="./images/redhat-logo.svg" title="Red Hat" alt="Red Hat"></a>
		<a ccID="13445" href="https://www.cgsinc.com/en/learning" target=_new"><img ccID="13503" class="header-logo" src="./images/cgsinc-logo.png" title="CGS Inc. Learning" alt="CGS Inc. Learning"></a> 
        <a ccID="13624" class="header-link" href="index.html">Home</a>
				
        <p ccID="13689" class="footer-copyright">Copyright © 2020 Red Hat, Inc.</p>
        <div ccID="13762" class="footer-linkContainer">
          <a ccID="13808" href="https://www.redhat.com/en/about/privacy-policy" class="footer-link">Privacy statement</a> <span ccID="13907" class=
          "footer-linkSpacer">|</span> <a ccID="13960" href="https://www.ansible.com/security?hsLang=en-us" class="footer-link">Security disclosure</a>
          <span ccID="14071" class="footer-linkSpacer">|</span> <a ccID="14112" href="https://www.redhat.com/en/about/all-policies-guidelines" class="footer-link">All
          policies and guidelines</a>
        </div>
      </div>
    </footer>
  </div><!--[if !IE]><script>fixScale(document);</script><![endif]-->
</body>
</html>
